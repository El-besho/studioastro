---
import Layout from '../../layouts/Layout.astro';
import { getAllCities, getAllServices } from '../../lib/services';
import { getSEOProps, generateCanonicalUrl } from '../../lib/seo';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../../components/ui/card';
import { Badge } from '../../components/ui/badge';
import { MapPin, Users, TrendingUp, Clock, Star } from 'lucide-react';

const cities = getAllCities();
const services = getAllServices();

const seoProps = {
  title: 'المواقع | خدمات إنقاذ في جميع أنحاء السعودية',
  description: 'اكتشف خدمات إنقاذ في جميع أنحاء المملكة العربية السعودية. نقدم خدمات منزلية متخصصة في 20+ مدينة مع أفضل المحترفين المعتمدين.',
  keywords: [
    'المواقع',
    'خدمات منزلية',
    'السعودية',
    'الرياض',
    'جدة',
    'الدمام',
    'مكة',
    'المدينة',
    'إنقاذ'
  ],
  canonical: generateCanonicalUrl('/locations')
};

const getEconomicLevelText = (level: string) => {
  const levels = {
    'very_high': 'مرتفع جداً',
    'high': 'مرتفع',
    'medium': 'متوسط',
    'low': 'منخفض'
  };
  return levels[level] || 'متوسط';
};

const getClimateText = (climate: string) => {
  const climates = {
    'hot_desert': 'صحراوي حار',
    'hot_arid': 'جاف حار',
    'mild_desert': 'صحراوي معتدل',
    'mountain': 'جبلي'
  };
  return climates[climate] || 'صحراوي حار';
};
---

<Layout {...seoProps}>
  <div class="container py-12 px-4 md:px-6">
    <div class="max-w-6xl mx-auto">
      <!-- Header -->
      <div class="text-center mb-12">
        <div class="flex items-center justify-center gap-2 mb-4">
          <MapPin class="h-8 w-8 text-primary" />
          <h1 class="font-headline text-4xl font-bold tracking-tighter sm:text-5xl md:text-6xl">
            المواقع
          </h1>
        </div>
        <p class="max-w-3xl mx-auto text-foreground/80 md:text-xl/relaxed">
          نقدم خدماتنا في جميع أنحاء المملكة العربية السعودية. 
          اكتشف الخدمات المتاحة في مدينتك واحصل على أفضل المحترفين المعتمدين.
        </p>
      </div>

      <!-- Stats -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-12">
        <Card class="text-center">
          <CardContent class="pt-6">
            <MapPin class="h-8 w-8 mx-auto mb-2 text-primary" />
            <div class="text-2xl font-bold">{cities.length}</div>
            <p class="text-sm text-muted-foreground">مدينة</p>
          </CardContent>
        </Card>
        <Card class="text-center">
          <CardContent class="pt-6">
            <Users class="h-8 w-8 mx-auto mb-2 text-primary" />
            <div class="text-2xl font-bold">{cities.reduce((sum, city) => sum + city.population, 0).toLocaleString()}</div>
            <p class="text-sm text-muted-foreground">نسمة</p>
          </CardContent>
        </Card>
        <Card class="text-center">
          <CardContent class="pt-6">
            <TrendingUp class="h-8 w-8 mx-auto mb-2 text-primary" />
            <div class="text-2xl font-bold">{services.length}</div>
            <p class="text-sm text-muted-foreground">خدمة</p>
          </CardContent>
        </Card>
        <Card class="text-center">
          <CardContent class="pt-6">
            <Star class="h-8 w-8 mx-auto mb-2 text-primary" />
            <div class="text-2xl font-bold">24/7</div>
            <p class="text-sm text-muted-foreground">خدمة طوارئ</p>
          </CardContent>
        </Card>
      </div>

      <!-- Cities Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {cities.map((city) => (
          <Card class="group hover:shadow-xl transition-all duration-300">
            <CardHeader>
              <div class="flex items-center justify-between">
                <CardTitle class="font-headline text-xl group-hover:text-primary transition-colors">
                  <a href={`/locations/${city.slug}`} class="hover:underline">
                    {city.ar_name}
                  </a>
                </CardTitle>
                <Badge variant="outline" class="text-xs">
                  {city.province}
                </Badge>
              </div>
              <CardDescription>
                {city.ar_name} هي واحدة من أهم المدن في المملكة العربية السعودية
              </CardDescription>
            </CardHeader>
            <CardContent>
              <div class="space-y-3">
                <div class="flex items-center gap-2 text-sm">
                  <Users class="h-4 w-4 text-muted-foreground" />
                  <span>عدد السكان: {city.population.toLocaleString()}</span>
                </div>
                <div class="flex items-center gap-2 text-sm">
                  <TrendingUp class="h-4 w-4 text-muted-foreground" />
                  <span>المستوى الاقتصادي: {getEconomicLevelText(city.economic_level)}</span>
                </div>
                <div class="flex items-center gap-2 text-sm">
                  <Clock class="h-4 w-4 text-muted-foreground" />
                  <span>المناخ: {getClimateText(city.climate)}</span>
                </div>
                
                <div class="pt-3">
                  <h4 class="font-semibold text-sm mb-2">الخدمات المتاحة:</h4>
                  <div class="flex flex-wrap gap-1">
                    {Object.entries(city.service_demand_multipliers)
                      .slice(0, 3)
                      .map(([service, multiplier]) => (
                        <Badge key={service} variant="secondary" class="text-xs">
                          {service === 'air-conditioning' ? 'تكييف' : 
                           service === 'luxury' ? 'فاخرة' : 
                           service === 'it-tech-services' ? 'تقنية' : service}
                        </Badge>
                      ))}
                    {Object.keys(city.service_demand_multipliers).length > 3 && (
                      <Badge variant="outline" class="text-xs">
                        +{Object.keys(city.service_demand_multipliers).length - 3}
                      </Badge>
                    )}
                  </div>
                </div>
                
                <div class="pt-3">
                  <a 
                    href={`/locations/${city.slug}`}
                    class="inline-flex items-center text-sm font-medium text-primary hover:underline"
                  >
                    عرض الخدمات في {city.ar_name} →
                  </a>
                </div>
              </div>
            </CardContent>
          </Card>
        ))}
      </div>

      <!-- CTA Section -->
      <Card class="mt-12 bg-primary/5 border-primary/20">
        <CardContent class="pt-6 text-center">
          <h3 class="font-headline text-2xl font-semibold mb-4">
            لا تجد مدينتك؟
          </h3>
          <p class="text-foreground/80 mb-6 max-w-2xl mx-auto">
            نحن نعمل باستمرار على توسيع خدماتنا لتشمل المزيد من المدن. 
            تواصل معنا لمعرفة متى ستتوفر خدماتنا في مدينتك.
          </p>
          <div class="flex flex-col sm:flex-row gap-4 justify-center">
            <a
              href="/contact"
              class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2"
            >
              تواصل معنا
            </a>
            <a
              href="/services"
              class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2"
            >
              عرض جميع الخدمات
            </a>
          </div>
        </CardContent>
      </Card>
    </div>
  </div>
</Layout>