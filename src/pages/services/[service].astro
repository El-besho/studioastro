---
import Layout from '../../layouts/Layout.astro';
import { getServiceBySlug, getAllServices } from '../../lib/services';
import { getSEOProps, generateCanonicalUrl } from '../../lib/seo';
import { ServiceGrid } from '../../components/service-grid';
import { Breadcrumb } from '../../components/semantic/breadcrumb';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../../components/ui/card';
import { Badge } from '../../components/ui/badge';
import { Check } from 'lucide-react';

export async function getStaticPaths() {
  const services = getAllServices();
  return services.map((service) => ({
    params: { service: service.slug },
    props: { service },
  }));
}

const { service } = Astro.props;

if (!service) {
  return Astro.redirect('/404');
}

const seoProps = {
  title: `${service.ar_name} | إنقاذ`,
  description: service.seo.summary,
  keywords: service.seo.primary_keywords,
  canonical: generateCanonicalUrl(`/services/${service.slug}`)
};
---

<Layout {...seoProps}>
  <div class="container py-12 px-4 md:px-6">
    <div class="max-w-6xl mx-auto">
      <!-- Breadcrumb -->
      <Breadcrumb client:load />
      
      <!-- Service Header -->
      <div class="text-center mb-12">
        <Badge class="font-headline bg-primary/10 text-primary hover:bg-primary/20 mb-4">
          {service.category}
        </Badge>
        <h1 class="font-headline text-4xl font-bold tracking-tighter sm:text-5xl md:text-6xl mb-4">
          {service.ar_name}
        </h1>
        <p class="max-w-3xl mx-auto text-foreground/80 md:text-xl/relaxed">
          {service.seo.description}
        </p>
      </div>

      <!-- Service Details -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12">
        <!-- Main Content -->
        <div class="lg:col-span-2">
          <Card>
            <CardHeader>
              <CardTitle class="font-headline text-2xl">خدمات {service.ar_name}</CardTitle>
              <CardDescription>
                نقدم مجموعة شاملة من خدمات {service.ar_name} بأعلى معايير الجودة
              </CardDescription>
            </CardHeader>
            <CardContent>
              <div class="prose prose-lg max-w-none">
                <p class="text-foreground/80 leading-relaxed">
                  {service.seo.summary}
                </p>
              </div>
            </CardContent>
          </Card>
        </div>

        <!-- Sidebar -->
        <div class="space-y-6">
          <!-- Sub Services -->
          <Card>
            <CardHeader>
              <CardTitle class="font-headline text-lg">الخدمات الفرعية</CardTitle>
            </CardHeader>
            <CardContent>
              <ul class="space-y-3">
                {service.sub_services.map((sub) => (
                  <li key={sub.id} class="flex items-center gap-3">
                    <Check class="h-5 w-5 text-primary flex-shrink-0" />
                    <a
                      href={`/services/${service.slug}/${sub.slug}`}
                      class="hover:underline hover:text-primary transition-colors"
                    >
                      {sub.ar_name}
                    </a>
                  </li>
                ))}
              </ul>
            </CardContent>
          </Card>

          <!-- CTA -->
          <Card class="bg-primary/5 border-primary/20">
            <CardContent class="pt-6">
              <h3 class="font-headline text-lg font-semibold mb-2">احصل على عرض سعر مجاني</h3>
              <p class="text-sm text-muted-foreground mb-4">
                تواصل معنا للحصول على أفضل عروض الأسعار
              </p>
              <a
                href="/contact"
                class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2 w-full"
              >
                اطلب عرض سعر
              </a>
            </CardContent>
          </Card>
        </div>
      </div>

      <!-- Related Services -->
      <div class="text-center mb-8">
        <h2 class="font-headline text-3xl font-bold tracking-tighter mb-4">
          خدمات أخرى قد تهمك
        </h2>
        <p class="text-foreground/80">
          اكتشف المزيد من الخدمات المتاحة في منصتنا
        </p>
      </div>
      
      <ServiceGrid services={getAllServices().filter(s => s.category === service.category && s.slug !== service.slug).slice(0, 6)} />
    </div>
  </div>
</Layout>