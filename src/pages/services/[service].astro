---
import Layout from '../../layouts/Layout.astro';
import { getServiceBySlug, getAllServices, getAllCities } from '../../lib/services';
import { getSEOProps, generateCanonicalUrl } from '../../lib/seo';
import { ServiceGrid } from '../../components/service-grid';
import { Breadcrumb } from '../../components/semantic/breadcrumb';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../../components/ui/card';
import { Badge } from '../../components/ui/badge';
import { Check } from 'lucide-react';
import { FAQ } from '../../components/service/FAQ';
import { ServiceFeatures } from '../../components/service/ServiceFeatures';
import { ProcessSteps } from '../../components/service/ProcessSteps';
import { SubServiceGrid } from '../../components/service/SubServiceGrid';
import { Testimonials } from '../../components/service/Testimonials';
import { ServiceStats } from '../../components/service/ServiceStats';
import { ServiceGallery } from '../../components/service/ServiceGallery';
import { ServiceProviders } from '../../components/service/ServiceProviders';
import { ServiceCTA } from '../../components/service/ServiceCTA';
import { FAQSchema } from '../../components/semantic/faq-schema';
import { CityServices } from '../../components/service/CityServices';
import { ComprehensiveContent } from '../../components/content/ComprehensiveContent';
import { DetailedProcess } from '../../components/content/DetailedProcess';
import InternalLinks from '../../components/seo/InternalLinks.astro';
import BreadcrumbSchema from '../../components/seo/BreadcrumbSchema.astro';
import ServiceSchema from '../../components/seo/ServiceSchema.astro';

export async function getStaticPaths() {
  const services = getAllServices();
  return services.map((service) => ({
    params: { service: service.slug },
    props: { service },
  }));
}

const { service } = Astro.props;

if (!service) {
  return Astro.redirect('/404');
}

const seoProps = {
  title: `${service.ar_name} | إنقاذ`,
  description: service.seo.summary,
  keywords: service.seo.primary_keywords,
  canonical: generateCanonicalUrl(`/services/${service.slug}`)
};
---

<Layout {...seoProps}>
  <!-- Schema Markup -->
  <BreadcrumbSchema items={[
    { name: 'الرئيسية', path: '/' },
    { name: 'الخدمات', path: '/services' },
    { name: service.ar_name, path: `/services/${service.slug}` }
  ]} />
  <ServiceSchema service={{
    name: service.ar_name,
    description: service.description,
    category: service.category,
    priceRange: '$$'
  }} />
  
  <div class="container py-12 px-4 md:px-6">
    <div class="max-w-6xl mx-auto">
      <!-- Breadcrumb -->
      <Breadcrumb client:load />
      
      <!-- Service Header -->
      <div class="text-center mb-12">
        <Badge class="font-headline bg-primary/10 text-primary hover:bg-primary/20 mb-4">
          {service.category}
        </Badge>
        <h1 class="font-headline text-4xl font-bold tracking-tighter sm:text-5xl md:text-6xl mb-4">
          {service.ar_name}
        </h1>
        <p class="max-w-3xl mx-auto text-foreground/80 md:text-xl/relaxed">
          {service.seo.description}
        </p>
      </div>

      <!-- Service Overview -->
      <Card class="mb-12">
        <CardHeader>
          <CardTitle class="font-headline text-2xl">خدمات {service.ar_name}</CardTitle>
          <CardDescription>
            نقدم مجموعة شاملة من خدمات {service.ar_name} بأعلى معايير الجودة
          </CardDescription>
        </CardHeader>
        <CardContent>
          <div class="prose prose-lg max-w-none">
            <p class="text-foreground/80 leading-relaxed">
              {service.seo.summary}
            </p>
          </div>
        </CardContent>
      </Card>

      <!-- Service Features -->
      <ServiceFeatures service={service} client:load />

      <!-- Sub Services Grid -->
      <div class="mb-12">
        <SubServiceGrid 
          subServices={service.sub_services} 
          serviceSlug={service.slug}
          serviceName={service.ar_name}
          client:load 
        />
      </div>

      <!-- Detailed Process -->
      <div class="mb-12">
        <DetailedProcess serviceType={service.slug} serviceName={service.ar_name} client:load />
      </div>

      <!-- Comprehensive Content -->
      <div class="mb-12">
        <ComprehensiveContent serviceType={service.slug} serviceName={service.ar_name} client:load />
      </div>

      <!-- Service Stats -->
      <div class="mb-12">
        <ServiceStats service={service} client:load />
      </div>

      <!-- Service Gallery -->
      <div class="mb-12">
        <ServiceGallery serviceName={service.ar_name} client:load />
      </div>

      <!-- Service Providers -->
      <div class="mb-12">
        <ServiceProviders serviceName={service.ar_name} client:load />
      </div>

      <!-- Testimonials -->
      <div class="mb-12">
        <Testimonials serviceName={service.ar_name} client:load />
      </div>

      <!-- FAQ Section -->
      {service.seo.faq && service.seo.faq.length > 0 && (
        <div class="mb-12">
          <FAQ faqs={service.seo.faq} client:load />
          <FAQSchema faqs={service.seo.faq} serviceName={service.ar_name} />
        </div>
      )}

      <!-- CTA Section -->
      <div class="mb-12">
        <ServiceCTA 
          serviceName={service.ar_name}
          isEmergency={service.emergency_available}
          priceRange={[100, 500]}
          responseTime="30 دقيقة"
          variant="hero"
          client:load 
        />
      </div>

      <!-- City Services Section -->
      <div class="mb-12">
        <CityServices 
          serviceName={service.ar_name}
          serviceSlug={service.slug}
          cities={getAllCities()}
          maxCities={12}
          client:load 
        />
      </div>

      <!-- Related Services -->
      <div class="text-center mb-8">
        <h2 class="font-headline text-3xl font-bold tracking-tighter mb-4">
          خدمات أخرى قد تهمك
        </h2>
        <p class="text-foreground/80">
          اكتشف المزيد من الخدمات المتاحة في منصتنا
        </p>
      </div>
      
      <ServiceGrid services={getAllServices().filter(s => s.category === service.category && s.slug !== service.slug).slice(0, 6)} />
      
      <!-- Internal Links for SEO -->
      <InternalLinks 
        currentService={service.id}
        type="service"
      />
    </div>
  </div>
</Layout>